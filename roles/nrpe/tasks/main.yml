- name: Write nagios check command config.
  tags:
    - nrpe-external-master-relation-changed
    - config-changed
  template:
    src: "check_name.cfg.jinja2"
    dest: "/etc/nagios/nrpe.d/{{ check_name }}.cfg"
    owner: nagios
    group: nagios
    mode: 0644
  notify:
    - Trigger nrpe hook

- name: Write nagios check service definition for export.
  tags:
    - nrpe-external-master-relation-changed
    - config-changed
  template:
    src: "check_name_service_export.cfg.jinja2"
    dest: "/var/lib/nagios/export/service__{{ service_context }}-{{ unit_name }}_{{ check_name }}.cfg"
    owner: nagios
    group: nagios
    mode: 0644
  notify:
    - Trigger nrpe hook
